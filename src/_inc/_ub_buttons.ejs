<%
// ----------------------------------------------------
// 1. Gulpã‹ã‚‰æ¸¡ã•ã‚ŒãŸå¤‰æ•°ã®å–å¾—
// ----------------------------------------------------
// t: ç¿»è¨³é–¢æ•° (t('key'))
// ub_buttons: ä¿®æ­£ã•ã‚ŒãŸãƒœã‚¿ãƒ³ãƒªã‚¹ãƒˆ [ã‚­ãƒ¼, ãƒ‡ãƒ¼ã‚¿å€¤, ç¯„å›²]
const t = page.t; 
const ub_buttons = page.ub_buttons; // Gulpã‚¿ã‚¹ã‚¯ã§ub_buttonsã¨ã—ã¦æ¸¡ã™ã“ã¨ã‚’æƒ³å®š
const def = page.def; // defã‚‚Gulpã‚¿ã‚¹ã‚¯ã‹ã‚‰æ¸¡ã™ã“ã¨ã‚’æƒ³å®š

// ----------------------------------------------------
// 2. ã‚¢ã‚¤ã‚³ãƒ³å–å¾—ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° (EJSå†…ã§å®šç¾©)
// ----------------------------------------------------
const getIcon = (range) => {
    if (range === 'self') return 'ğŸ‘¤';
    if (range === 'all') return 'ğŸ‘¥';
    if (range === 'enemy') return 'ğŸ‘¹';
    return '';
};
%>

<ul class="filter_container" data-filter="ub_type" data-count="<%= ub_buttons.length %>">
    <div class="target-container target-cell" id="ub-target-container">
        <span class="target-label"><%- t('filter.target') %></span>
        <div class="target-selector">
            <button class="target-button" data-range="self">ğŸ‘¤<%- t('filter.target.self') %></button>
            <button class="target-button" data-range="all">ğŸ‘¥<%- t('filter.target.ally') %></button>
            <button class="target-button" data-range="enemy">ğŸ‘¹<%- t('filter.target.enemy') %></button>
        </div>
    </div>
    <% for (const button of ub_buttons) {
        const key = button[0];    // ä¾‹: "ub_type.hp_recovery"
        const data_key_string = button[1]; // ä¾‹: "HPå›å¾©" ã¾ãŸã¯ "ç‰©ç†æ”»æ’ƒUP,é­”æ³•æ”»æ’ƒUP"

        // ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚ºå‰Šæ¸›ã®ãŸã‚defã®ã‚­ãƒ¼ã‚’çŸ­ã„ã‚³ãƒ¼ãƒ‰ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã€ã‚«ãƒ³ãƒã§çµåˆ
        const val = data_key_string.split(",").map(x => def[x]).join(","); 
        const range = button[2];  // "all", "self", "enemy", ""

        // ç¿»è¨³ã‚­ãƒ¼ã‹ã‚‰ã€ç¾åœ¨ã®è¨€èªã®ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
        const name = t(key);

        // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—
        const icon = getIcon(range);

        // ã‚¢ã‚¤ã‚³ãƒ³ã¨ç¿»è¨³æ¸ˆã¿ãƒ©ãƒ™ãƒ«ã‚’çµåˆã—ã€æ˜‡é †/é™é †ãƒãƒ¼ã‚¯ã‚’HTMLã«å¤‰æ›
        const label = icon + name
        .replace(/â¬†/g, '<span class="arrow-mark up">â¬†</span>')
        .replace(/â¬‡/g, '<span class="arrow-mark down">â¬‡</span>');
    %>
        <% if (range !== "") { %>
        <li data-range="<%= range %>" data-name="<%= name %>" data-val="<%= val %>" data-check="0"><div><%- label %></div></li>
        <% } else { %>
        <li data-val="<%= val %>" data-check="0"><div><%- label %></div></li>
        <% } %>
    <% } %>
</ul>